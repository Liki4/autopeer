{% extends 'base.html' %}

{% block content %}
<div class='row'>
	<div class='col-lg-6'>
		<h1>Peerings</h1>
	</div>
	<div class='col-lg-6 float-right text-right'>
		<a href='/peerings/new/' class='btn btn-primary'>Create peering</a>
	</div>

	<div class='col-lg-12' style='margin-top: 1rem;'>
		<table class='table table-striped'>
			<thead>
				<tr>
					<th scope='col'>ASN</th>
					<th scope='col'>State</th>
					<th scope='col'>Router</th>
					<th scope='col'>Endpoint</th>
					<th scope='col'>Type</th>
					<th scope='col'>Routes</th>
					<th scope='col'>Traffic avg.</th>
					<th scope='col'></th>
			</thead>

			<tbody>
				{% for peering in object_list %}
					<tr>
						{% with status=peering.get_status %}
						<th scope='row'><a href='/peerings/{{peering.id}}/'>{{ peering.asn }}</a></th>
						<td>
							{% if status.state == 'up' %}
								<span class='badge badge-success'>{{ status.state }}</span>
							{% else %}
								<span class='badge badge-warning'>{{ status.state }}</span>
							{% endif %}
						</td>
						<td>
							{{ peering.router.location }}<br />
							<small>{{ peering.router.host_internal }}</small>
						</td>
						<td>
							{{ peering.endpoint }}<br />
							<small>{{ peering.endpoint_internal }}
						</td>
						<td>{{ peering.get_vpn_type_display }}</td>
						<td>
							{% if status %}
								{{ status.routes_received }} imported<br />
								{{ status.routes_preferred }} preferred<br />
								{{ status.routes_filtered }} filtered
							{% else %}
								<em>Not available</em>
							{% endif %}
						</td>
						{% endwith %}
						<td>
							{% with traffic=peering.get_traffic %}
								{% if traffic %}
									Receive: {{ traffic.rx }}/s<br />
									Transmit: {{ traffic.tx }}/s<br />
								{% else %}
									<em>Not available</em>
								{% endif %}
							{% endwith %}
						</td>
						<td>
							<a class='btn btn-secondary' href='/peerings/{{ peering.id }}/'>Details</a>
						</td>
					</tr>
				{% endfor %}
			</tbody>
		</table>

		{% if not object_list %}
			<p>You don't seem to have any peerings. <a href='/peerings/new/'>Create one!</a></p>
		{% endif %}
	</div>
	<div class='col-lg-12' style='margin-top: 3rem;'>
		<small>If you want to modify something not listed here or if something's broken, feel free to poke me on IRC (lutoma on hackint) or by email (lutoma@ohai.su).</small>
	</div>
</div>
{% endblock %}